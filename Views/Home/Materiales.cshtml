@{
    ViewBag.Title = "Materiales";
}
@{
    var rol = ViewBag.Rol as string;
}
<div class="container mt-5">
    <h2>Gestión de Materiales</h2>
    @if (string.IsNullOrEmpty(rol))
    {
        <div class="alert alert-warning mt-5 text-center">
            Debes iniciar sesión para acceder a esta sección.<br />
            <a href="@Url.Action("Login", "Account")" class="btn btn-success mt-3 rounded-pill px-4"><i class="bi bi-person-circle"></i> Iniciar sesión</a>
        </div>
    }
    else if (rol == "Administrador" || rol == "Vendedor")
    {
    <div class="mb-3">
    <a href="@Url.Action("ExportarMaterialesExcel", "Home")" class="btn btn-success me-2">Exportar Excel</a>
    <a href="@Url.Action("ExportarMaterialesPdf", "Home")" class="btn btn-danger">Exportar PDF</a>
    </div>
    <div class="row">
        <div class="col-md-7">
            <h4>Lista de Materiales</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var m in ViewBag.Materiales)
                    {
                        <tr>
                            <td>@m.Id</td>
                            <td>@m.Nombre</td>
                            <td>@m.Descripcion</td>
                            <td>$@m.Precio</td>
                            <td>@m.Stock</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editarMaterial(@m.Id, '@m.Nombre', '@m.Descripcion', @m.Precio, @m.Stock)">Editar</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col-md-5">
            <h4 id="form-title">Agregar Material</h4>
            <form method="post" asp-action="AgregarMaterial" id="material-form">
                <input type="hidden" name="Id" id="material-id" />
                <div class="mb-2">
                    <label>Nombre</label>
                    <input type="text" name="Nombre" id="material-nombre" class="form-control" required />
                </div>
                <div class="mb-2">
                    <label>Descripción</label>
                    <input type="text" name="Descripcion" id="material-descripcion" class="form-control" />
                </div>
                <div class="mb-2">
                    <label>Precio</label>
                    <input type="number" step="0.01" name="Precio" id="material-precio" class="form-control" required />
                </div>
                <div class="mb-2">
                    <label>Stock</label>
                    <input type="number" name="Stock" id="material-stock" class="form-control" required />
                </div>
                <button type="submit" id="agregar-btn" class="btn btn-primary">Agregar</button>
                <button type="submit" formaction="@Url.Action("EditarMaterial", "Home")" id="editar-btn" class="btn btn-success d-none">Guardar Cambios</button>
                <button type="button" onclick="resetForm()" class="btn btn-secondary">Cancelar</button>
            </form>
        </div>
    </div>
    <script>
    function editarMaterial(id, nombre, descripcion, precio, stock) {
        document.getElementById('form-title').innerText = 'Editar Material';
        document.getElementById('material-id').value = id;
        document.getElementById('material-nombre').value = nombre;
        document.getElementById('material-descripcion').value = descripcion;
        document.getElementById('material-precio').value = precio;
        document.getElementById('material-stock').value = stock;
        document.getElementById('agregar-btn').classList.add('d-none');
        document.getElementById('editar-btn').classList.remove('d-none');
    }
    function resetForm() {
        document.getElementById('form-title').innerText = 'Agregar Material';
        document.getElementById('material-id').value = '';
        document.getElementById('material-nombre').value = '';
        document.getElementById('material-descripcion').value = '';
        document.getElementById('material-precio').value = '';
        document.getElementById('material-stock').value = '';
        document.getElementById('agregar-btn').classList.remove('d-none');
        document.getElementById('editar-btn').classList.add('d-none');
    }
    </script>
    <a href="@Url.Action("Index", "Home")" class="btn btn-secondary mt-3">Volver</a>
    }
    else
    {
    <div class="alert alert-warning">No tienes permisos para gestionar materiales.</div>
    }
</div>
